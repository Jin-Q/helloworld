<?xml version="1.0" encoding="UTF-8"?>
<S>

<!--*************** 1.不良资产begin ****************-->

<!--  不良移交申请校验  -->
<SQL id="checkBadasset" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(1)cc from arp_badasset_handover_app a where a.approve_status in ('000','111','991','992','993','997')
 and a.bill_no = ${_SIG_VALUE}
  ]]>
    </SELECT>
</SQL>

<!--  不良移交申请流程结束时，修改移交申请表中办结日期  -->
<SQL id="ArpBadassetHandoverAppDate" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update arp_badasset_handover_app set over_date = (select openday from PUB_SYS_INFO ) where serno = ${_SIG_VALUE} 
  ]]>
   </UPDATE>
</SQL>

<!--  不良移交申请流程结束时，生成移交接收记录  -->
<SQL id="ArpBadassetHandoverAppRecv" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
insert into arp_badasset_handover_rcv(
 select a.serno ,a.bill_no,a.fount_manager_br_id,a.fount_manager_id,a.handover_resn,
 a.bad_resn,a.collect_measures,a.rcv_org,a.rcv_person,a.memo,a.app_date,a.over_date,
 '' as rcv_date , '001' as rcv_status , a.cus_id from arp_badasset_handover_app a 
 where a.serno = ${_SIG_VALUE}  )
  ]]>
   </UPDATE>
</SQL>

<!--  8位日期转10位  -->
<SQL id="changeDateToTen" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
   select to_char(to_date(${_SIG_VALUE},'yyyy-mm-dd'),'yyyy-mm-dd') from dual
  ]]>
    </SELECT>
</SQL>

<!--  外币计算  -->
<SQL id="delCurType" parameterClass="java.util.HashMap" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
   select round(${transAmt}*(select base_remit from prd_rate_maintain where fount_cur_type = ${curType}),2 ) from dual 
  ]]>
    </SELECT>
</SQL>

<!--*************** 1.不良资产end ****************-->

<!--*************** 2.法律措施begin ****************-->

<!--  债务人信息校验  -->
<SQL id="ArpLawDebtorInfo" parameterClass="java.util.HashMap" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from arp_law_member_info a where a.member_type = ${member_type} and  serno = ${serno} and a.cus_id = ${cus_id}
  ]]>
    </SELECT>
</SQL>

<!--  债务人管理校验  -->
<SQL id="ArpLawDebtorMana" parameterClass="java.util.HashMap" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from arp_law_member_mana a where a.member_type = ${member_type} and  case_no = ${serno} and a.cus_id = ${cus_id}
  ]]>
    </SELECT>
</SQL>

<!--  诉讼明细校验  -->
<SQL id="ArpLawLawsuitDetail" parameterClass="java.util.HashMap" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
  select count(*)cc from Arp_Law_Lawsuit_Detail where serno = ${serno} and bill_no = ${bill_no}
  ]]>
    </SELECT>
</SQL>

<!--  诉讼明细校验  -->
<SQL id="ArpLawLawsuitDtmana" parameterClass="java.util.HashMap" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
  select count(*)cc from Arp_Law_Lawsuit_Dtmana where case_no = ${serno} and bill_no = ${bill_no}
  ]]>
    </SELECT>
</SQL>

<!--  重新合计诉讼费用  -->
<SQL id="updateLawsuitFee" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update arp_law_lawsuit_app a set 
 a.lawsuit_cap = (select sum(lawsuit_cap) from arp_law_lawsuit_detail b where serno = a.serno) ,
 a.lawsuit_int = (select sum(lawsuit_int) from arp_law_lawsuit_detail b where serno = a.serno) ,
 a.lawsuit_sub = (select sum(lawsuit_sub) from arp_law_lawsuit_detail b where serno = a.serno) 
 where serno = ${_SIG_VALUE} 
  ]]>
   </UPDATE>
</SQL>

<!--  重新管理诉讼费用  -->
<SQL id="manaLawsuitFee" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update arp_law_lawsuit_info a set 
 a.lawsuit_cap = (select sum(lawsuit_cap) from arp_law_lawsuit_dtmana b where case_no = a.case_no) ,
 a.lawsuit_int = (select sum(lawsuit_int) from arp_law_lawsuit_dtmana b where case_no = a.case_no) ,
 a.lawsuit_sub = (select sum(lawsuit_sub) from arp_law_lawsuit_dtmana b where case_no = a.case_no) 
 where case_no = ${_SIG_VALUE} 
  ]]>
   </UPDATE>
</SQL>

<SQL id="dealMemberToMana" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
insert into ARP_LAW_MEMBER_MANA(
 select a.pk_serno, ${_SIG_VALUE} , a.member_type , a.cus_id  
 from arp_law_member_info a where a.serno = ${_SIG_VALUE} )
  ]]>
   </UPDATE>
</SQL>

<SQL id="dealDetailToMana" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
insert into arp_law_lawsuit_DTMANA(
 select a.pk_serno,${_SIG_VALUE},a.cus_id,a.bill_no,a.lawsuit_sub,a.lawsuit_cap,a.lawsuit_int
 from arp_law_lawsuit_detail a where a.serno = ${_SIG_VALUE} )
  ]]>
   </UPDATE>
</SQL>

<SQL id="dealAppOverdate" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update Arp_Law_Lawsuit_App set over_date = (select openday from pub_sys_info) where serno =  ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>

<SQL id="dealAppToInfo" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
insert into arp_law_lawsuit_info (
select a.serno,${_SIG_VALUE},a.app_date, a.over_date, a.law_disp_mode,'','',a.lawsuit_cap,a.lawsuit_int,
 a.other_fee, a.lawsuit_sub, a.executable_property_status,a.lawsuit_reason,a.whether_invite_agt_lawyer,
 a.agt_type,a.agt_agreed_indgt,a.agcy,a.agcy_link_mode,a.belg_lawyer_office,a.agt_fee_pay_rate,a.agt_fee_pay_amt,
 a.other_indictee, a.indictee_status,a.memo,a.manager_id,a.manager_br_id,a.input_id,a.input_br_id,a.input_date,'1' as status
 from Arp_Law_Lawsuit_App a where serno = ${_SIG_VALUE} )
  ]]>
   </UPDATE>
</SQL>

<!--*************** 2.法律措施end ****************-->

<!--*************** 3.债权减免管理begin ****************-->
<!-- 债权减免申请页面取明细和 -->
<SQL id="SumBondReducDetail" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
  <SELECT>
  <![CDATA[
select count(*)nums , nvl(sum(a.reduc_cap),0) as reduc_cap , 
 nvl(sum(a.reduc_inner_owe_int+a.reduc_out_owe_int),0) as reduc_int
 from ARP_BOND_REDUC_DETAIL a where serno = ${_SIG_VALUE} 
  ]]>
  </SELECT>
</SQL>

<!--  重新合计债权减免明细信息  -->
<SQL id="updateBondReduc" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update ARP_BOND_REDUC_APP a set 
 a.REDUC_QNT = (select count(*) from ARP_BOND_REDUC_DETAIL where serno = a.serno) 
 where serno = ${_SIG_VALUE} 
  ]]>
   </UPDATE>
</SQL>

<!--  债权减免申请客户校验  -->
<SQL id="CusidBondReduc" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from ARP_BOND_REDUC_APP a where a.approve_status not in ('997','998') and cus_id = ${_SIG_VALUE} 
  ]]>
    </SELECT>
</SQL>

<!--  债权减免明细校验  -->
<SQL id="BondReducDetail" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from ARP_BOND_REDUC_DETAIL where  bill_no = ${_SIG_VALUE} 
 and serno in (select serno from ARP_BOND_REDUC_APP where approve_status not in ('990','997','998') )
  ]]>
    </SELECT>
</SQL>

<!--*************** 3.债权减免管理end ****************-->

<!--*************** 4.以物抵债begin ****************-->
<!--  动态获取业务抵债信息表中的汇总数据  -->
<SQL id="getArpBusiSum" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
  <![CDATA[
select sum(a.debt_cap + a.debt_inner_int + a.debt_out_int +a.debt_other_expense) as debt_in_amt,
       sum(a.debt_cap) as debt_cap,
       sum(a.debt_inner_int) as inner_int,
       sum(a.debt_out_int) as off_int,
       sum(a.debt_other_expense) as debt_expense
  from arp_busi_debt_info a
 where a.serno = ${_SIG_VALUE}
  ]]>
    </SELECT>
</SQL>
<!-- 以物抵债申请流程结束后生成以物申请台账 -->
<SQL id="dealCollDebtAppToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
insert into arp_coll_debt_acc (select a.serno,
       ${_SIG_VALUE},
       a.app_date,
       a.end_date,
       a.cus_id,
       '',
       a.debt_mode,
       a.debt_in_amt,
       a.debt_cap,
       a.inner_int,
       a.off_int,
       a.debt_expense,
       a.coll_debt_resn,
       a.collect_addr,
       a.asset_status,
       '',
       a.is_handover,
       a.memo,
       a.manager_id,
       a.manager_br_id,
       a.input_id,
       a.input_br_id,
       a.input_date,
       '00' 
  from arp_coll_debt_app a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>

<!-- 以物抵债申请流程结束后生成抵债物关联表 -->
<SQL id="dealCollDebtReAppToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
 insert into arp_coll_debt_acc_re (select a.serno,
       ${_SIG_VALUE},
       a.guaranty_no,
       a.debt_in_amt,
       '01',
       a.rel 
 from arp_coll_debt_re a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>
<!-- 更新以物抵债物关联表 （台账）-->
<SQL id="updateArpCollDebtAccRe" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
update arp_coll_debt_acc_re set status='02' where serno=${_SIG_VALUE}
  ]]>
    </UPDATE>
</SQL>
<!-- 抵债资产处置申请流程结束后生成抵债资产处置台账 -->
<SQL id="dealCollDispAppToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
  insert into arp_coll_disp_acc
  (select a.serno,
          ${_SIG_VALUE},
          a.app_date,
          a.end_date,
          a.guaranty_no,
          a.asset_disp_mode,
          a.fore_disp_expense,
          a.disp_amt,
          a.disp_memo,
          a.memo,
          a.manager_id,
          a.manager_br_id,
          a.input_id,
          a.input_br_id,
          a.input_date
     from arp_coll_disp_app a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>
<!-- 抵债资产处置申请流程结束后生成资产出售信息台账 -->
<SQL id="dealSaleToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
 insert into ARP_ASSET_SALE_ACC_INFO
  (select a.serno,
          ${_SIG_VALUE},
          a.guaranty_no,
          a.debt_in_amt,
          a.eval_amt,
          a.sale_amt,
          a.sale_date,
          a.sale_mode,
          a.memo,
          '01'
     from ARP_ASSET_SALE_INFO a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>
<!-- 抵债资产处置申请流程结束后生成资产出租信息台账 -->
<SQL id="dealRentToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
  insert into ARP_ASSET_RENT_ACC_INFO
  (select a.serno,
          ${_SIG_VALUE},
          a.guaranty_no,
          a.debt_in_amt,
          a.renta_paid_mode,
          a.rent_amt,
          a.mort_amt,
          a.lessee,
          a.lessee_phone,
          a.lessee_addr,
          a.lessee_cert_type,
          a.lessee_cert_no,
          a.lease_start_date,
          a.lease_end_date,
          a.memo,
          '01'
     from ARP_ASSET_RENT_INFO a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>
<!-- 抵债资产处置申请流程结束后生成资产转固信息台账 -->
<SQL id="dealPegToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
insert into arp_asset_peg_ACC_info
  (select a.serno,
          ${_SIG_VALUE},
          a.guaranty_no,
          a.debt_in_amt,
          a.to_prop_value,
          a.eval_amt,
          a.disp_resn,
          a.asgn_date,
          a.memo,
          '01'
     from arp_asset_peg_info a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>
<!-- 抵债资产处置申请流程结束后生成资产核销信息台账 -->
<SQL id="dealWriteoffToAcc" parameterClass="java.lang.String" valueClass="java.lang.String" >
    <UPDATE>
  <![CDATA[
insert into arp_asset_WRITEOFF_ACC_info
  (select a.serno,
          ${_SIG_VALUE},
          a.guaranty_no,
          a.debt_in_amt,
          a.writeoff_amt,
          a.disp_resn,
          a.writeoff_date,
          a.memo,
          '01'
     from arp_asset_WRITEOFF_info a where a.serno=${_SIG_VALUE})
  ]]>
    </UPDATE>
</SQL>

<!--  抵债物合计  -->
<SQL id="SumArpCollDebtRe" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select sum(debt_in_amt) as guar_amt from Arp_Coll_Debt_Re where serno = ${_SIG_VALUE} 
  ]]>
    </SELECT>
</SQL>
<!--  以物抵债客户校验  -->
<SQL id="CusidArpCollDebtApp" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from Arp_Coll_Debt_App a where a.approve_status not in ('997','998') and cus_id = ${_SIG_VALUE} 
  ]]>
    </SELECT>
</SQL>
<!--  以物抵债明细校验  -->
<SQL id="BusiDebtDetail" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from Arp_Busi_Debt_Info where serno in 
 (select serno from Arp_Coll_Debt_App where approve_status not in ('990','997','998'))
 and bill_no = ${_SIG_VALUE}
  ]]>
    </SELECT>
</SQL>
<!--*************** 4.以物抵债end ****************-->

<!--*************** 5.呆账管理begin ****************-->

<!--  重新管理诉讼费用  -->
<SQL id="updateDbtCongniz" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update ARP_DBT_CONGNIZ_APP a set 
 a.qnt = (select count(*) from ARP_DBT_BIZ_REL  where serno = a.serno) ,
 a.loan_balance = (select sum(loan_balance) from ARP_DBT_BIZ_REL  where serno = a.serno) 
 where serno = ${_SIG_VALUE} 
  ]]>
   </UPDATE>
</SQL>

<!--  重新管理诉讼费用  -->
<SQL id="updateDbtWriteoff" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update ARP_DBT_WRITEOFF_APP a set 
 a.writeoff_qnt = (select count(*) from ARP_DBT_WRITEOFF_DETAIL  where serno = a.serno) ,
 a.loan_balance = (select sum(loan_balance) from ARP_DBT_WRITEOFF_DETAIL  where serno = a.serno) 
 where serno = ${_SIG_VALUE} 
  ]]>
   </UPDATE>
</SQL>

<!--  呆账认定申请客户校验  -->
<SQL id="CusidDbtCongniz" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from ARP_DBT_CONGNIZ_APP a where a.approve_status not in ('997','998') and cus_id = ${_SIG_VALUE} 
  ]]>
    </SELECT>
</SQL>

<!--  呆账认定明细校验  -->
<SQL id="DbtCongnizDetail" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from (select bill_no from ARP_DBT_BIZ_REL where serno in 
 (select serno from ARP_DBT_CONGNIZ_APP where approve_status not in ('990','997','998'))
 union select bill_no from ARP_DBT_CONGNIZ_ACC ) where bill_no = ${_SIG_VALUE}
  ]]>
    </SELECT>
</SQL>

<!-- 生成呆账认定台账  -->
<SQL id="insertArpDbtCongnizAcc" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
insert into arp_dbt_congniz_acc (
 select a.serno,a.pk_serno,b.cus_id  ,a.bill_no,a.cont_no,b.congniz_resn,(select openday from pub_sys_info ) 
 from arp_dbt_biz_rel a ,arp_dbt_congniz_app b where a.serno = b.serno and b.serno = ${_SIG_VALUE} )
  ]]>
   </UPDATE>
</SQL>

<!-- 呆账认定申请表生成办结日期  -->
<SQL id="dealArpDbtCongnizAppOverdate" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update arp_dbt_congniz_app set over_date = (select openday from pub_sys_info) where serno =  ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>

<!-- 呆账核销申请页面取明细和 -->
<SQL id="SumDbtWriteoffDetail" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
  <SELECT>
  <![CDATA[
select count(*)nums,nvl(sum(a.loan_amt),0) as loan_amt_sum ,nvl(sum(a.loan_balance ),0) as loan_balance_sum,
 nvl(sum(a.owe_int),0) as owe_int_sum, nvl(sum(a.inner_owe_int),0) as inner_owe_int_sum, 
 nvl(sum(a.out_owe_int),0) as out_owe_int_sum, nvl(sum(a.writeoff_amt),0) as writeoff_amt_sum,
 nvl(sum(a.writeoff_cap),0) as writeoff_cap_sum, nvl(sum(a.writeoff_int),0) as writeoff_int_sum 
 from ARP_DBT_WRITEOFF_DETAIL a where serno = ${_SIG_VALUE} 
  ]]>
  </SELECT>
</SQL>

<!--  呆账核销申请客户校验  -->
<SQL id="CusidDbtWriteoff" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from ARP_DBT_WRITEOFF_APP a where a.approve_status not in ('997','998') and cus_id = ${_SIG_VALUE} 
  ]]>
    </SELECT>
</SQL>

<!--  呆账核销明细校验  -->
<SQL id="DbtWriteoffDetail" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
select count(*)cc from (select bill_no from ARP_DBT_WRITEOFF_DETAIL where serno in 
 (select serno from ARP_DBT_WRITEOFF_APP where approve_status not in ('990','997','998'))
 union select bill_no from ARP_DBT_WRITEOFF_ACC ) where bill_no = ${_SIG_VALUE}
  ]]>
    </SELECT>
</SQL>

<!-- 生成呆账核销台账  -->
<SQL id="insertArpDbtWriteoffAcc" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
insert into ARP_DBT_WRITEOFF_ACC(
 select a.serno,a.pk_serno,a.bill_no,a.cont_no,b.cus_id,a.writeoff_amt,a.writeoff_cap,writeoff_cap,
 a.writeoff_int,writeoff_int,'',b.manager_br_id
 from ARP_DBT_WRITEOFF_DETAIL a , ARP_DBT_WRITEOFF_APP b where a.serno = b.serno and b.serno = ${_SIG_VALUE} )
  ]]>
   </UPDATE>
</SQL>

<!-- 呆账核销申请表生成办结日期  -->
<SQL id="dealArpDbtWriteoffAppOverdate" parameterClass="java.lang.String" valueClass ="java.lang.String" >
   <UPDATE>
  <![CDATA[
update ARP_DBT_WRITEOFF_APP set over_date = (select openday from pub_sys_info) where serno =  ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>
<!--*************** 5.呆账管理end ****************-->

</S>