<?xml version="1.0" encoding="UTF-8"?>
<S>
<!--查询批次下票据期限不能包含制定日期的票据-->
<SQL id="getBillsByDate" parameterClass="java.util.HashMap" resultClass="com.ecc.emp.data.KeyedCollection" onlyReturnFirst="false">
  <SELECT>
  <![CDATA[
	 select b.porder_no,b.bill_isse_date,b.porder_end_date 
	 from Iqp_Batch_Bill_Rel a inner join iqp_bill_detail b 
	      on a.porder_no=b.porder_no
     where a.batch_no=${batch_no} and (b.bill_isse_date>${bill_isse_date} or b.porder_end_date<${porder_end_date})
  ]]>
  </SELECT>
</SQL>

<!--根据流水号获取,该业务下票据批次的实付总金额和贴现总利息-->
<SQL id="getBatchTotalInfoBySerno" parameterClass="java.util.HashMap" resultClass="com.ecc.emp.data.KeyedCollection" onlyReturnFirst="false">
  <SELECT>
  <![CDATA[
	 select a.batch_no, a.serno, b.int, a.rpay_amt, a.bill_total_amt,a.fore_disc_date,a.bill_qnt,a.rate,a.rebuy_date,a.rebuy_rate,a.rebuy_int
  		from iqp_batch_mng a,
       		(select sum(int) int, batch_no from iqp_bill_income group by batch_no) b
 		where a.batch_no = b.batch_no
 		      and a.serno = ${serno}
  ]]>
  </SELECT>
</SQL>

<!-- 根据业务申请流水获取批次明细-->
<SQL id="getBatchMngBySerno" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" onlyReturnFirst="false">
  <SELECT>
  <![CDATA[
	 select * from iqp_batch_mng where serno = ${_SIG_VALUE}
  ]]>
  </SELECT>
</SQL>

</S>