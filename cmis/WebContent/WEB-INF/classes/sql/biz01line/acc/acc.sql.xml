<?xml version="1.0" encoding="UTF-8"?>
<S>
<!-- 通过担保合同编号查询台账信息-->
<SQL id="getAcc" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.IndexedCollection" onlyReturnFirst="false">
    <SELECT> 
     <![CDATA[
  	   select a.*,b.assure_main from acc_view a,ctr_loan_cont b where a.cont_no=b.cont_no and b.cont_no in (${_SIG_VALUE}) 
     ]]>
    </SELECT> 
</SQL>

<!-- 通过客户码查询台账信息[modified by yangzy 2014/11/07 无间贷引入偿还借据，过滤已在途业务]-->
<SQL id="getAccPop" parameterClass="java.util.HashMap" resultClass="com.ecc.emp.data.KeyedCollection" > 
    <SELECT> 
     <![CDATA[
       select a.bill_no,
              a.cus_id,
              a.cont_no,
              a.prd_id,
              a.loan_amt as bill_amt,
              a.loan_balance as bill_bal,
              ctr.limit_ind,
              ctr.limit_acc_no,
              ctr.limit_credit_no
         from acc_loan a, ctr_loan_cont ctr
        where a.cont_no = ctr.cont_no
          and a.cus_id = ${cus_id}
          and a.acc_status = '1'
          and a.end_date >= ${openDay}
          and not exists
        (select 1
                 from iqp_loan_app p1, iqp_loan_app_sub p2
                where p1.serno = p2.serno
                  and p2.repay_bill = a.bill_no
                  and p1.approve_status in ('000', '111', '992', '993'))
          and not exists (select 1
                 from ctr_loan_cont p3, ctr_loan_cont_sub p4
                where p3.cont_no = p4.cont_no
                  and p4.repay_bill = a.bill_no
                  and p3.cont_status in ('100', '200'))
     ]]> 
    </SELECT>  
</SQL>

</S>