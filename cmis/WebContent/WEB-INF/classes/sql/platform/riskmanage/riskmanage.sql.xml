<?xml version="1.0" encoding="UTF-8"?>
<S>
	
<!-- 根据流程类型获得风险拦截信息 -->
<SQL id="queryPreventByProcType" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" onlyReturnFirst="false">
  <SELECT>
  <![CDATA[
    SELECT * FROM WFI_WORKFLOW2BIZ WHERE APPL_TYPE=${_SIG_VALUE} 
  ]]>
  </SELECT> 
</SQL>
<!-- 删除原有风险拦截记录 -->
<SQL id="deleteIqpPvRiskResult" parameterClass="java.util.HashMap" >
  <DELETE>
  <![CDATA[
  	DELETE FROM IQP_PV_RISK_RESULT WHERE SERNO=${serno} AND WFID=${wfid} AND NODE_ID=${node_id}
  ]]>
  </DELETE>
</SQL>

<!-- 根据业务申请流水号获取担保下的融资性担保公司 -->
<SQL id="queryFinCusIdBySerno" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select e.cus_id
  			from grt_loan_r_gur   a,
       		grt_guar_cont    b,
       		grt_guaranty_re  c,
       		grt_guarantee    d,
       		lmt_agr_fin_guar e
 			where a.serno = ${_SIG_VALUE}
   			and a.guar_cont_no = b.guar_cont_no
   			and b.guar_way in ('02', '03', '04')
   			and b.guar_cont_no = c.guar_cont_no
   			and c.guaranty_id = d.guar_id
   			and d.cus_id = e.cus_id
  	 		and e.agr_status = '002'
      ]]>
    </SELECT>
</SQL>

<!-- 根据担保公司客户号判断该担保公司是否为改客户做过担保 -->
<SQL id="checkIs4Cus" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
          select iqpRel.Cont_No
           from grt_loan_r_gur iqpRel,ctr_loan_cont ctr
           where iqpRel.Cont_No=ctr.cont_no 
           and ctr.cont_status in('200','500','600','900') 
           and iqpRel.Guar_Cont_No in
           (select grtRe.Guar_Cont_No
           from grt_guaranty_re grtRe
           where grtRe.Guaranty_Id in
           (select grt.guar_id
           from Grt_Guarantee grt
           where grt.cus_id = ${_SIG_VALUE}))
      ]]>
    </SELECT>
</SQL>

<!-- 获取当前融资性担保公司所担保的存量业务  modified by yangzy 2015/04/27 融资性担保公司担保获取存量业务改造 -->
<!-- 获取当前融资性担保公司所担保的存量业务  modified by yangzy 2014/12/20 融资性担保公司担保占用改造(增加存量过渡数据) -->
<SQL id="queryIqpContByFinCusId" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select distinct iqp.serno, ctr.cont_no
  			from iqp_loan_app     iqp,
       		ctr_loan_cont ctr,
       		grt_loan_r_gur   a,
       		grt_guar_cont    b,
       		grt_guaranty_re  c,
       		grt_guarantee    d,
       		lmt_agr_fin_guar e
 			where iqp.serno = ctr.serno(+)
   			and iqp.serno = a.serno
   			and a.guar_cont_no = b.guar_cont_no
   			and b.guar_way in ('02', '03', '04')
   			and b.guar_cont_no = c.guar_cont_no
   			and c.guaranty_id = d.guar_id
   			and d.cus_id = e.cus_id
   			and e.agr_status = '002'
   			and e.cus_id = ${_SIG_VALUE}
   			and (ctr.cont_status in ('100','200') or ctr.cont_no is null)
   	       union all
   	       	select distinct iqp.serno, ctr.cont_no
			  from ctr_loan_cont    ctr,
			       iqp_loan_app     iqp,
			       grt_loan_r_gur   a,
			       grt_guar_cont    b,
			       grt_guaranty_re  c,
			       grt_guarantee    d,
			       lmt_agr_fin_guar e
			 where ctr.serno = iqp.serno(+)
			   and ctr.CONT_NO = a.CONT_NO
			   and a.guar_cont_no = b.guar_cont_no
			   and b.guar_way in ('02', '03', '04')
			   and b.guar_cont_no = c.guar_cont_no
			   and c.guaranty_id = d.guar_id
			   and d.cus_id = e.cus_id
			   and e.agr_status = '002'
			   and e.cus_id = ${_SIG_VALUE}
			   and ctr.cont_status in ('100', '200')
			   and iqp.serno is null
      ]]>
    </SELECT>
</SQL>

<!-- 获取该合同的有效贷款总额 modified by yangzy 2015/07/30 需求：XD150407026， 更新存量外币业务的汇率 -->
<SQL id="queryLoanAmtByContNo" parameterClass="java.lang.String" resultClass="java.lang.String" >
    <SELECT>
      <![CDATA[
           select (a.cont_balance + nvl(b.loan_balance, 0)) * a.exchange_rate loan_amt
  				from ctr_loan_cont a,
       				(select nvl(sum(loan_balance), 0) loan_balance, cont_no
          				from acc_loan 
         				group by cont_no) b
 				where a.cont_no = b.cont_no(+)
   				and a.cont_no = ${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>

<!-- 获取该申请的有效贷款总额 modified by yangzy 2015/07/30 需求：XD150407026， 更新存量外币业务的汇率-->
<SQL id="queryLoanAmtBySerno" parameterClass="java.lang.String" resultClass="java.lang.String" >
    <SELECT>
      <![CDATA[
          select a.apply_amount*a.exchange_rate loan_amt from iqp_loan_app a where a.serno = ${_SIG_VALUE} 
      ]]>
    </SELECT>
</SQL>

<!-- 获取当前融资性担保公司所担保的单户存量业务 -->
<SQL id="queryIqpContByFinCusIdForCus" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select iqp.serno, ctr.cont_no
  			from iqp_loan_app     iqp,
       		ctr_loan_cont    ctr,
       		grt_loan_r_gur   a,
       		grt_guar_cont    b,
       		grt_guaranty_re  c,
       		grt_guarantee    d,
       		lmt_agr_fin_guar e
 			where iqp.serno = ctr.serno(+)
   			and iqp.serno = a.serno
   			and a.guar_cont_no = b.guar_cont_no
   			and b.guar_way in ('02', '03', '04')
   			and b.guar_cont_no = c.guar_cont_no
   			and c.guaranty_id = d.guar_id
   			and d.cus_id = e.cus_id
   			and e.agr_status = '002'
   			and e.cus_id = ${FIN_CUS_ID}
   			and iqp.cus_id = ${CUS_ID}
      ]]>
    </SELECT>
</SQL>

<!-- 根据业务申请流水号获取客户所属联保小组的所有成员 -->
<SQL id="queryJointCusIdBySerno" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select cus_id
  			 from lmt_name_list
 			 where agr_no =
       		 (select c.agr_no
          	 from iqp_loan_app a, lmt_agr_joint_coop b, lmt_name_list c
         	 where a.serno = ${_SIG_VALUE}
           	 and b.coop_type = '010'
           	 and b.agr_status = '002'
           	 and a.cus_id = c.cus_id
           	 and b.agr_no = c.agr_no
           	 and c.cus_status = '1')
      ]]>
    </SELECT>
</SQL>

<!-- 根据融资担保公司下的所有保证金账号 -->
<SQL id="queryBailNoByFinCusId" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select b.bail_acct_no
  			 from lmt_agr_fin_guar a, pub_bail_info b
 			 where a.agr_no = b.cont_no
   			 and a.cus_id = ${_SIG_VALUE}
   			 and a.agr_status = '002'
      ]]>
    </SELECT>
</SQL>
<!-- 贷后检查必输项校验    王青  start -->
<!-- 定期检查，借款人分析 -->
<SQL id="custabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A00E225022268ADBB3780CDC0'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，借款人分析-个人客户经营性-->
<SQL id="custabPersonByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA27870186AC649B81C1BD49E92F3C'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，借款人分析-个人客户消费性-->
<SQL id="custabPersonXFByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A01540B408DDF86D4BD01757E'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，固定资产贷款（项目融资）分析 -->
<SQL id="propertytabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A00B2557223491A5E0046C80E'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，资产状况调查-->
<SQL id="propertyanalytabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA2787019371B94A4ADA7DD8B181C1'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，资产状况调查中的固定资产分析-->
<SQL id="propertyanalytabGDZCByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Property_Analy
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，财务分析-->
<SQL id="fnctabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A01818DBC31BBA42C3CE30FC2'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，经营佐证信息-->
<SQL id="opertabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Check_Analy
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，监控信息-->
<SQL id="montabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A002897AC98FC2E65ADAD25B5'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，监控信息新增-->
<SQL id="montabAddByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Cap_Use_Monitor
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，监控信息还款来源信息-->
<SQL id="montabHKByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Repay_Src
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，监控信息-个人客户-->
<SQL id="montabPersonByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA278700603B7CFDD2235452DAF996'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，担保分析中的分析担保品[modified by yangzy 2014/10/17 贷后任务改造]-->
<SQL id="grttabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT distinct task_id,scheme_id
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID like ${_SIG_VALUE}||'%'
   			 and scheme_id = 'FFFA276A01CBD3827D90989AA0C031FD'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，担保分析中的分析保证人-对公客户、小微客户、集团客户[modified by yangzy 2014/10/17 贷后任务改造]-->
<SQL id="grttabDGByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT distinct task_id,scheme_id
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID like ${_SIG_VALUE}||'%'
   			 and scheme_id in ('FFFA276A016098037E87488513680CA2','FFFA2787002D8A2F4F8F9A072E082729')
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，担保分析中的分析保证人-个人客户 [modified by yangzy 2014/10/17 贷后任务改造] -->
<SQL id="grttabPersonByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT distinct task_id,scheme_id
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID like ${_SIG_VALUE}||'%'
   			 and scheme_id in ('FFFA2787002D8A2F4F8F9A072E082729','FFFA276A016098037E87488513680CA2')
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，单一法人风险预警-->
<SQL id="sigltabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA278400B191CDD61CDC9F820782A0'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，集团风险预警-->
<SQL id="sigltabJTByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276901EF01EF7001CDC23A63B8CC'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，关注事件-->
<SQL id="evttabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA278401F12D4FD621682ECE4C639E'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，集团关注事件-->
<SQL id="evttabJTByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA278401D2E04BD5DC10E6A2E55B67'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，预警信息 -->
<SQL id="alttabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_App_Alt_Signal
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，合作方分析 -->
<SQL id="custabHZByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A01A0D5102854480D8AD824FA'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，合作方综合评价 -->
<SQL id="evltabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A007425EB9C6B348CAFC75CD8'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，担保公司客户综合评价 -->
<SQL id="evltabDBByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A00F8963C9C74909B7BF8ACBA'
      ]]>
    </SELECT>
</SQL>
<!-- 定期检查，融资担保公司分析 -->
<SQL id="custabRZByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA276A004983D88F56E31D8ED70920'
      ]]>
    </SELECT>
</SQL>
<!-- 零售客户，水电费明细必输项校验 -->
<SQL id="water_charge_analyByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Check_Analy
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 经营佐证中的税费明细校验 -->
<SQL id="opertabTaxByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Tax_Detail
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 经营佐证中的水电费明细 -->
<SQL id="opertabTaxSDFByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Fee_Detail
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>

<!-- 经营佐证中的银行对账单 -->
<SQL id="opertabTaxYHDZByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Bank_Contacc
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 经营佐证中的工资对账单 -->
<SQL id="opertabTaxGZDZByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Wage_Contacc
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 经营佐证中的出入库 -->
<SQL id="opertabTaxCRKByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Iostore_Doc
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 经营佐证中的订单明细 -->
<SQL id="opertabTaxDDMXByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           SELECT *
  			 FROM Psp_Order_Analy
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 小微客户，财务分析结论 -->
<SQL id="finatabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
            SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID =${_SIG_VALUE}
   			 and scheme_id = 'FFFA274301455148F65B5310D8FCF6B1'
      ]]>
    </SELECT>
</SQL>
<!-- 首次检查，资金用途监控 -->
<SQL id="capusetabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
            SELECT *
  			 FROM Psp_Cap_Use_Monitor
  			 WHERE TASK_ID =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- 首次检查，检查情况(对公、小微、零售) -->
<SQL id="resulttabByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
            SELECT *
  			 FROM PSP_CHECK_ITEM_RESULT
  			 WHERE TASK_ID = ${_SIG_VALUE}
  			 and scheme_id in ('FFFA276A01E32CD6123E4115A0E177DA','FFFA276A00708D302141BE5F1ED983EC')
      ]]>
    </SELECT>
</SQL>

<!-- 贷后检查必输项校验    王青  end -->
<!-- 根据联保授信台账获取联保协议下的所有保证金账号 -->
<SQL id="queryJointBailNoByLimitCode" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select c.bail_acct_no
  			 from lmt_agr_details a, lmt_agr_joint_coop b, pub_bail_info c
 			 where a.sub_type = '03'
   			 and a.lmt_status = '10'
   			 and b.coop_type = '010'
   			 and b.agr_status = '002'
   			 and a.limit_code = ${_SIG_VALUE}
   			 and b.agr_no = c.cont_no
   			 and a.agr_no = b.agr_no
      ]]>
    </SELECT>
</SQL>

<!-- 根据联保授信台账获取相同联保协议下的额度台账 -->
<SQL id="queryJointLimitCodeByLimitCode" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select limit_code
  			 from lmt_agr_details
 			 where agr_no = (select a.agr_no
                   from lmt_agr_details a, lmt_agr_joint_coop b
                  where a.agr_no = b.agr_no
                    and a.limit_code = ${_SIG_VALUE}
                    and a.sub_type = '03'
                    and a.lmt_status = '10'
                    and b.coop_type = '010'
                    and b.agr_status = '002')
   			 and sub_type = '03'
   			 and lmt_status = '10'
      ]]>
    </SELECT>
</SQL>

<!-- 根据联保授信台账获取相同联保协议下的所有单户额度台账 -->
<SQL id="queryJointLimitCodeByLimitCodeForCus" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select limit_code
  			 from lmt_agr_details
 			 where agr_no = (select a.agr_no
                   from lmt_agr_details a, lmt_agr_joint_coop b
                  where a.agr_no = b.agr_no
                    and a.limit_code = ${LIMIT_ACC_NO}
                    and a.sub_type = '03'
                    and a.lmt_status = '10'
                    and b.coop_type = '010'
                    and b.agr_status = '002')
   			 and sub_type = '03'
   			 and lmt_status = '10'
   			 and cus_id = ${CUS_ID}
      ]]>
    </SELECT>
</SQL>

<!-- add by lisj 2015-3-5  需求编号 :【XD150306018】根据联保授信台账编号查询台账授信金额  -->
<SQL id="queryCrdAmtByLimitCode" parameterClass="java.lang.String" resultClass="java.lang.String" >
    <SELECT>
      <![CDATA[
           select crd_amt from lmt_agr_details where limit_code = ${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>

<!-- 根据业务申请编号获取需要担保检查的担保合同（一般担保合同且状态为“登记”）[mpdified by yangzy 2014/11/05 去掉一般担保合同过滤] -->
<SQL id="queryGuarContNoBySernoForRiskManage" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select b.guar_cont_no
  			 from grt_loan_r_gur a, grt_guar_cont b
 			 where a.serno = ${_SIG_VALUE}
   			 and a.guar_cont_no = b.guar_cont_no
      ]]>
    </SELECT>
</SQL>

<!-- 根据业务申请编号获取需要担保检查的担保合同 -->
<SQL id="guarContNoBySerno" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select b.guar_cont_no
  			 from grt_loan_r_gur a, grt_guar_cont b,pub_sys_info c
 			 where a.serno = ${_SIG_VALUE}
   			 and a.guar_cont_no = b.guar_cont_no
   			 and b.guar_end_date <= c.openday
      ]]>
    </SELECT>
</SQL>

<!-- 获取合作方下所关联的单户的存量业务风险敞口金额 -->
<SQL id="queryIqpContByCoopCusId" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select a.serno,a.cont_no from r_bus_lmtcredit_info a,iqp_loan_app b where a.agr_no = ${LIMIT_CREDIT_NO} and a.lmt_type = '03' and b.cus_id = ${CUS_ID} and a.serno = b.serno
      ]]>
    </SELECT>
</SQL>

<!-- 获取行业授信下所关联的单户的存量业务风险敞口金额 -->
<SQL id="queryIqpContByIndusCusId" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select a.serno,a.cont_no from r_bus_lmtcredit_info a,iqp_loan_app b where a.agr_no = ${LIMIT_CREDIT_NO} and a.lmt_type = '03' and b.cus_id = ${CUS_ID} and a.serno = b.serno
      ]]>
    </SELECT>
</SQL>

<!-- 获取圈商授信下所关联的单户的存量业务风险敞口金额 -->
<SQL id="queryIqpContByAreaCusId" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select a.serno,a.cont_no from r_bus_lmtcredit_info a,iqp_loan_app b where a.agr_no = ${LIMIT_CREDIT_NO} and a.lmt_type = '03' and b.cus_id = ${CUS_ID} and a.serno = b.serno
      ]]>
    </SELECT>
</SQL>

<!-- modified by lisj 2015-2-2 需求编号【HS141110017】保理业务改造 begin -->
<!-- 根据担保合同获取应收账款回款保证金结果[added by yangzy 2014/11/03 应收账款类质押校验担保金额合规是需要回款保证金金额 ]-->
<SQL id="getBailAccInfo4Grt" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
  <SELECT>
  <![CDATA[
		select distinct p2.bail_acc_no
	  		from grt_guaranty_re p1,
	       (select drfpo_no po_no, bail_acc_no
	          from iqp_drfpo_mana
	        union all
	        select t1.po_no, t2.bail_acc_no
	          from iqp_actrecpo_mana t1, iqp_bailacc_detail t2
	         where t1.po_no = t2.po_no) p2
	 		where p1.guaranty_id = p2.po_no
	   		and p1.guar_cont_no = ${_SIG_VALUE}
  ]]>
  </SELECT>
</SQL>
<!-- modified by lisj 2015-2-2 需求编号【HS141110017】保理业务改造 end -->

<!-- 根据业务池编号获取需要检查的担保合同[added by yangzy 2014/12/12 应收账款类出池校验，在池是否覆盖敞口] -->
<SQL id="queryGuarContNoByPoNo" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select p1.guar_cont_no
			  from grt_guaranty_re p1
			 where p1.guaranty_id = ${_SIG_VALUE}
			   and (exists
			        (select 1 from iqp_actrecpo_mana p3 where p1.guaranty_id = p3.po_no) or
			        exists
			        (select 1 from iqp_drfpo_mana p3 where p1.guaranty_id = p3.drfpo_no))
			   and exists (select 1
			          from grt_guar_cont p2
			         where p1.guar_cont_no = p2.guar_cont_no
			           and p2.guar_cont_state in ('01', '02'))
      ]]>
    </SELECT>
</SQL>
<!-- modified by lisj 2015-1-20  需求编号：【XD141029074】增加授信企业关联担保提醒事项（风险拦截类） 于2015-1-22上线-->
<SQL id="queryGuarContNo4CusDoByCusId" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
          select t.guar_cont_no,
        		 t.cus_id,
        		 t.guar_cont_state,
        		 (select s.cnname from s_dic s 
        		 	where s.enname = t.cur_type) as cur_type
   				from grt_guar_cont t
  				where t.guar_cont_no in
        			(select g1.guar_cont_no
           				from grt_guaranty_re g1, grt_guarantee g2
          				where g1.guaranty_id = g2.guar_id
           			    and g2.cus_id = ${_SIG_VALUE})
    					and t.guar_cont_state in ('00', '01')
    					and t.cus_id is not null
    		and exists (select 1
        		  from grt_loan_r_gur p1
         			where p1.guar_cont_no = t.guar_cont_no
				 			and exists (select 1 from acc_view p2
											where p1.cont_no = p2.cont_no
                  							 and p2.status in ('1', '6')))
      ]]>
    </SELECT>
</SQL>

<!-- added by yangzy 2015/1/7 需求:XD141222090,公司小微贷后检查改造-小微、公司检查当前财报 
      modified by lisj 2015-5-19 需求编号：XD150504034 贷后管理常规检查任务改造，去除报表口径过滤-->
<SQL id="queryFncByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from psp_check_task p1
			 where exists
			 (select 1
			          from fnc_stat_base p2
			         where p1.cus_id = p2.cus_id
			           and to_char(add_months(to_date(p1.task_create_date, 'yyyy-mm-dd'),
			                                  -1),
			                       'yyyymm') = p2.stat_prd
			           and p2.state_flg like '%2')
			   and p1.task_id = ${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/7 需求:XD141222090,公司小微贷后检查改造-小微、公司检查经营佐证 -->
<SQL id="queryPspPropertyAnalyByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select * from
			(select distinct task_id from psp_fee_detail where task_id = ${_SIG_VALUE}
			union all
			select distinct task_id from psp_tax_detail where task_id = ${_SIG_VALUE}
			union all
			select distinct task_id from psp_bank_contacc where task_id = ${_SIG_VALUE}
			union all
			select distinct task_id from psp_wage_contacc where task_id = ${_SIG_VALUE}
			union all
			select distinct task_id from psp_iostore_doc where task_id = ${_SIG_VALUE}
			union all
			select distinct task_id from psp_order_analy where task_id = ${_SIG_VALUE})
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查现场检查借款企业 -->
<SQL id="queryPspVisitForJKRByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from psp_sitecheck_com t
			 where t.task_id = ${_SIG_VALUE}
			   and t.visit_type = '01'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查现场检查固定资产 -->
<SQL id="queryPspVisitForGDZCByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
              from psp_sitecheck_com t
             where t.task_id = ${_SIG_VALUE}
               and t.visit_type = '04'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查现场检查现场检查结论 -->
<SQL id="queryPspVisitForJCJLByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from psp_check_analy
			 where task_id = ${_SIG_VALUE}
			   and visit_analy is not null
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查现场检查现场抵（质）押品检查 -->
<SQL id="queryPspVisitForDZYByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from psp_sitecheck_com t
			 where t.task_id = ${_SIG_VALUE}
			   and t.visit_type = '03'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查现场检查现场担保企业检查 -->
<SQL id="queryPspVisitForDBQYByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from psp_sitecheck_com t
			 where t.task_id = ${_SIG_VALUE}
			   and t.visit_type = '02'
      ]]>
    </SELECT>
</SQL>

<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查征信检查借款企业关键个人征信检查  -->
<SQL id="queryPspZXForQYGJGRByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Zxqk_Loan
			 where task_id = ${_SIG_VALUE}
			   and cus_type = '01'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查征信检查保证人征信检查 -->
<SQL id="queryPspZXForBZRByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Zxqk_Loan
			 where task_id = ${_SIG_VALUE}
			   and cus_type = '02'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/27 需求:XD141230092,零售检查征信检查保证人征信检查 -->
<SQL id="queryPspZXForBZRGRByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Zxqk_Loan
			 where task_id = ${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/27 需求:XD141230092,零售检查现场检查借款人    2015-03-03 Edited by FCL  删除 （and t.visit_type = '01'）-->
<SQL id="queryPspVisitGrForJKRByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Sitecheck_Com_Gr t
			 where t.task_id = ${_SIG_VALUE}			   
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/27 需求:XD141230092,零售现场检查现场抵（质）押品检查 -->
<SQL id="queryPspVisitGrForDZYByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Sitecheck_Com_Gr t
			 where t.task_id = ${_SIG_VALUE}
			   and t.visit_type = '04'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/27 需求:XD141230092,零售现场检查现场担保检查 -->
<SQL id="queryPspVisitGrForDBQYByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Sitecheck_Com_Gr t
			 where t.task_id = ${_SIG_VALUE}
			   and t.visit_type = '03'
      ]]>
    </SELECT>
</SQL>
<!-- added by yangzy 2015/1/22 需求:XD141222090,小微、公司检查征信检查借款人检查 -->
<SQL id="queryPspZXForJKRByTaskID" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select *
			  from Psp_Zxqk_Detail t
			 where t.task_id = ${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>

<!-- added by yangzy 2015/1/7 需求:XD141222090,公司小微贷后检查改造-小微、公司检查担保企业财报
     modified by lisj 2015-5-19 需求编号：XD150504034 贷后管理常规检查任务改造，去除报表口径过滤 
     modified by yangzy 2015-09-02 需求编号：XD150625045 贷后管理常规检查任务改造,过滤追加保证-->
<SQL id="queryGrtGuaranteeFncMsgByTaskID"  parameterClass="java.util.HashMap" resultClass="com.ecc.emp.data.KeyedCollection">
  <SELECT>
  <![CDATA[
		select *
		  from (select distinct cus_id,
		                        cus_name,
		                        cert_type,
		                        cert_code,
		                        cus_type,
		                        belg_line
		          from (select distinct (f.cus_id) as cus_id,
		                                f.cus_name,
		                                f.cert_type,
		                                f.cert_code,
		                                f.cus_type,
		                                f.belg_line,
                                    e.is_spadd,
                                    g.belg_line cus_belg_line,
                                    case
                                      when e.is_spadd = '1' then
                                       '2'
                                      else
                                       '1'
                                    end as flag
                      from ctr_loan_cont   a,
                           grt_loan_r_gur  b,
                           grt_guar_cont   c,
                           grt_guaranty_re d,
                           grt_guarantee   e,
                           cus_base        f,
                           cus_base        g
                where a.cus_id = ${cus_id}
                    and a.cus_id = g.cus_id
                    and a.cont_status = '200'
                    and a.cont_no = b.cont_no
                    and b.guar_cont_no = c.guar_cont_no
                    and c.guar_cont_no = d.guar_cont_no
                    and d.guaranty_id = e.guar_id
					and b.corre_rel not in('3','5')
					and c.GUAR_CONT_STATE = '01'
                    and e.cus_id = f.cus_id)
             where flag = '1') tmp
     where tmp.belg_line in ('BL100', 'BL200')
       and not exists
     (select 1
              from fnc_stat_base p1, psp_check_task p2
             where tmp.cus_id = p1.cus_id
               and p1.stat_prd =
                   to_char(add_months(to_date(p2.task_create_date, 'yyyy-mm-dd'),
                                      -1),
                           'yyyymm')
               and p2.task_id = ${task_id}
               and p1.state_flg like '%2')
  ]]>
  </SELECT>
</SQL>

<!-- added by yangzy 2015-09-02 需求编号：XD150625045 贷后管理常规检查任务改造,过滤追加保证-->
<SQL id="queryGrtGuaranteeFncMsgByTaskID2"  parameterClass="java.util.HashMap" resultClass="com.ecc.emp.data.KeyedCollection">
  <SELECT>
  <![CDATA[
		SELECT *
		  FROM (SELECT DISTINCT CUS_ID,
		                        CUS_NAME,
		                        CERT_TYPE,
		                        CERT_CODE,
		                        CUS_TYPE,
		                        BELG_LINE
		          FROM PSP_GUAR_ANALY_REL
		         WHERE TASK_ID = ${task_id}) TMP
		 WHERE TMP.BELG_LINE IN ('BL100', 'BL200')
		   AND NOT EXISTS
		 (SELECT 1
		          FROM FNC_STAT_BASE P1, PSP_CHECK_TASK P2
		         WHERE TMP.CUS_ID = P1.CUS_ID
		           AND P1.STAT_PRD =
		               TO_CHAR(ADD_MONTHS(TO_DATE(P2.TASK_CREATE_DATE, 'yyyy-mm-dd'),
		                                  -1),
		                       'yyyymm')
		           AND P2.TASK_ID = ${task_id}
		           AND P1.STATE_FLG LIKE '%2')
  ]]>
  </SELECT>
</SQL>

<!-- add by lisj 2015-1-14  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="querySubPspBatchTaskListByTaskId" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
          select p.sub_task_id from psp_batch_task_rel p where p.major_task_id =${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>
<!-- add by lisj 2015-1-14  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="checkPspBatchTaskInfoByTaskId" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
			select count(*) from psp_check_task p1
 				where (p1.check_time is not null and p1.check_view is not null and
       				p1.task_id = ${_SIG_VALUE} and p1.batch_task_type = '01')
    				or (p1.check_time is not null and p1.task_id = ${_SIG_VALUE} and
      				 p1.batch_task_type = '02')
  ]]>
    </SELECT>
</SQL>
<!-- add by lisj 2015-1-26  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="checkPspCheckTaskInfoByTaskId" parameterClass="java.lang.String" resultClass="java.lang.String">
    <SELECT>
  <![CDATA[
			select count(*) from psp_check_task p1
 				where p1.check_time is not null 
 					  and p1.check_view is not null 
 					  and p1.task_id = ${_SIG_VALUE}
  ]]>
    </SELECT>
</SQL>
<!-- add by lisj 2015-1-14  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="updateLoanTotlAmtByTaskId" parameterClass="java.lang.String" valueClass="java.math.BigDecimal">
   <UPDATE>
  <![CDATA[
	update psp_check_task p set p.loan_totl_amt = ${_SIG_VALUE} where p.task_id = ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>
<!-- add by lisj 2015-1-14  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="updateLoanBalanceByTaskId" parameterClass="java.lang.String" valueClass="java.math.BigDecimal">
   <UPDATE>
  <![CDATA[
	update psp_check_task p set p.loan_balance = ${_SIG_VALUE} where p.task_id = ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>
<!-- add by lisj 2015-1-14  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="updateQntByTaskId" parameterClass="java.lang.String" valueClass="java.math.BigDecimal">
   <UPDATE>
  <![CDATA[
	update psp_check_task p set p.qnt = ${_SIG_VALUE} where p.task_id = ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>
<!-- add by lisj 2015-1-14  需求编号：【XD150108001】贷后管理系统需求（房地产、汽车、小微、个人经营性100万元以下批量功能 -->
<SQL id="queryPspBatchTaskRelByTaskId" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection">
   <UPDATE>
  <![CDATA[
	select p.major_task_id from psp_batch_task_rel p where p.sub_task_id = ${_SIG_VALUE}
  ]]>
   </UPDATE>
</SQL>
<!-- add by lisj 2015-10-27 需求编号：XD150930072 分支机构部分授权权限调整，变更低风险业务授权使用范围 begin  -->
<!-- add by lisj 2015-4-10 需求编号：【XD150407025】分支机构授信审批权限配置 ,检查授信申请业务是否属于低风险授权业务  -->
<SQL id="checkBizYNLowRisk" parameterClass="java.lang.String" resultClass="java.lang.String" onlyReturnFirst="false" >
   <SELECT>
  <![CDATA[
	select count(*)
  from grt_guaranty_re p1, mort_guaranty_base_info p2
 where p1.guaranty_id = p2.guaranty_no
   and (exists (select 1
                  from s_treedic s
                 where s.opttype = 'MORT_TYPE'
                   and s.enname in ('A040201',
                                    'A030202',
                                    'A030201',
                                    'A030103',
                                    'A030102',
                                    'A030101')
                   and p2.guaranty_type = s.enname) or
        (exists (select 1
                          from s_treedic g1, lmt_app_details g2
                         where g1.opttype = 'MORT_TYPE'
                           and g1.enname in ('A010101',
                           					 'A010102',
                           					 'A080102')
                           and  g1.enname = p2.guaranty_type
                           and g2.limit_code in
                               (select r.limit_code
                                  from r_lmt_app_guar_cont r
                                 where r.guar_cont_no = p1.guar_cont_no)
                           and g2.guar_type <> '210')))							
   and p2.non_affi_third = '2'
   and p1.guar_cont_no = ${_SIG_VALUE}
  ]]>
   </SELECT>
</SQL>
<!-- add by lisj 2015-10-27 需求编号：XD150930072 分支机构部分授权权限调整，变更低风险业务授权使用范围 end  -->
<!-- added by yangzy 2015/4/23  零售贷后检查改造,个人经营性贷款经营佐证资料变更 -->
<SQL id="queryPspCheckTask4GRJYX" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
		select *
		  from psp_check_task_rel t
		 where t.task_id = ${_SIG_VALUE}
		   and exists (select 1
		          from acc_loan t1
		         where t.bill_no = t1.bill_no
		           and instr('100035,100036,100037,100038,100034,100039,100040',
		                     t1.prd_id) > 0)
      ]]>
    </SELECT>
</SQL>
<!-- 获取保理相关存量业务 added by yangzy 2015/05/29 需求编号：HS141110017，保理业务改造，过滤保理签订质押合同模式 -->
<SQL id="queryIqpContByPoNoSernoForFact" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select distinct serno, cont_no
			  from (select p1.serno, p1.cont_no
			          from ctr_loan_cont p1
			         where exists (select 1
			                  from iqp_inter_fact p2
			                 where p1.serno = p2.serno
			                   and p2.po_no = ${po_no})
			           and p1.cont_status in ('100', '200')
			        union
			        select p1.serno, '' cont_no
			          from iqp_loan_app p1
			         where exists (select 1
			                  from iqp_inter_fact p2
			                 where p1.serno = p2.serno
			                   and p2.po_no = ${po_no})
			           and p1.approve_status = '111'
			           and p1.serno <> ${serno}
			        union all
			        select p1.serno, '' cont_no
			          from iqp_loan_app p1
			         where p1.serno = ${serno})
      ]]>
    </SELECT>
</SQL>
<!-- 获取保理相关存量业务 added by yangzy 2015/05/29 需求编号：HS141110017，保理业务改造，过滤保理签订质押合同模式 -->
<SQL id="queryIqpContByPoNoForFact" parameterClass="com.ecc.emp.data.KeyedCollection" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
			select distinct serno, cont_no
			  from (select p1.serno, p1.cont_no
			          from ctr_loan_cont p1
			         where exists (select 1
			                  from iqp_inter_fact p2
			                 where p1.serno = p2.serno
			                   and p2.po_no = ${po_no})
			           and p1.cont_status in ('100', '200')
			        union
			        select p1.serno, '' cont_no
			          from iqp_loan_app p1
			         where exists (select 1
			                  from iqp_inter_fact p2
			                 where p1.serno = p2.serno
			                   and p2.po_no = ${po_no})
			           and p1.approve_status = '111')
      ]]>
    </SELECT>
</SQL>

<!-- add by lisj 2015-9-15 需求编号：【XD150303015】 关于增加对被放款审查岗打回的业务申请信息进行修改流程需求-->
<SQL id="compareContAmtWithFPAmt" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select count(*) cc
  			from ctr_loan_cont_tmp a
 			where (select repay_type from ctr_loan_cont_sub_tmp where modify_rel_serno = a.modify_rel_serno) ='A001'
   		and a.cont_amt != (select sum(suppose_pay_cap) amt
                        from iqp_freedom_pay_info_tmp
                       where modify_rel_serno = a.modify_rel_serno)
   		and (select count(*) from iqp_freedom_pay_info_tmp where modify_rel_serno = a.modify_rel_serno) > 0
   		and a.modify_rel_serno = ${_SIG_VALUE}
      ]]>
    </SELECT>
</SQL>

<SQL id="compareContDateWithFPDate" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select count(*) cc
  			from ctr_loan_cont_tmp a
 			where (select repay_type
          from ctr_loan_cont_sub_tmp
         where modify_rel_serno = a.modify_rel_serno) = 'A001'
   and (select count(*)
          from iqp_freedom_pay_info
         where modify_rel_serno = a.modify_rel_serno) > 0
   and a.modify_rel_serno = ${_SIG_VALUE}
   and a.cont_amt =
       (select sum(suppose_pay_cap) amt
          from iqp_freedom_pay_info_tmp
         where modify_rel_serno = a.modify_rel_serno)
   and a.cont_end_date !=
       (select pay_date
          from iqp_freedom_pay_info_tmp p
         where p.modify_rel_serno = a.modify_rel_serno
           and dateno =
               (select max(to_number(dateno))
                  from iqp_freedom_pay_info_tmp
                 where modify_rel_serno = p.modify_rel_serno))

      ]]>
    </SELECT>
</SQL>

<SQL id="comparePayDateWithFPPayDate" parameterClass="java.lang.String" resultClass="com.ecc.emp.data.KeyedCollection" >
    <SELECT>
      <![CDATA[
           select count(a.pay_date) cc from iqp_freedom_pay_info_tmp a,ctr_loan_cont_tmp b
            where a.modify_rel_serno = b.modify_rel_serno and b.modify_rel_serno =${_SIG_VALUE}
            group by a.pay_date having count(a.pay_date) > 1
      ]]>
    </SELECT>
</SQL>
</S>