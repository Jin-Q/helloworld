<?xml version="1.0" encoding='GB18030'?>
<rule-set name="S_USER">

<java:import>java.lang.Object</java:import>
<java:import>java.lang.String</java:import>
<java:import>java.util.Map</java:import>
<java:import>com.ecc.emp.core.Context</java:import>
<java:import>com.ecc.shuffle.common.Utils</java:import>

<db:columns>state</db:columns>

<rule name="query" salience="1" isolation="yes">
<parameter identifier="context">
	<class>com.ecc.emp.core.Context</class>
</parameter>
<parameter identifier="paramMap">
	<class>java.util.HashMap</class>
</parameter>
<java:condition>true</java:condition>

<java:consequence>
if(context.getDataValue("currentUserId").toString().equals("admin")){
	paramMap.put("_result_","1=1");
}
else{
	String orgid=(String)context.getDataValue("organNo");
	for(int i=1;5>i;i++){
		if(orgid.substring(10-i*2,orgid.length()).equals("00")){
			orgid=orgid.substring(0,10-i*2);
		}
	}
	paramMap.put("_result_","ACTORNO in (select ACTORNO from S_DEPTUSER where ORGANNO like '"+orgid+"%')");
}
</java:consequence>
</rule>

<rule name="update" salience="2" isolation="yes">
<parameter identifier="context">
	<class>com.ecc.emp.core.Context</class>
</parameter>
<parameter identifier="paramMap">
	<class>java.util.HashMap</class>
</parameter>
<java:condition>true</java:condition>

<java:consequence>
		if(!"0".equals(paramMap.get("state")))
			paramMap.put("_result_","1=1");
		else{
			if(context.getDataValue("currentUserId").toString().equals("test")){
				paramMap.put("_result_","1=1");
			}else{
				paramMap.put("_result_","1=2");
			}
    }
</java:consequence>
</rule>

<rule name="delete" salience="2" isolation="yes">
<parameter identifier="context">
	<class>com.ecc.emp.core.Context</class>
</parameter>
<parameter identifier="paramMap">
	<class>java.util.HashMap</class>
</parameter>
<java:condition>true</java:condition>

<java:consequence> 
    if("0".equals(paramMap.get("state").toString()))
			paramMap.put("_result_","1=2");
		else{
			if(context.getDataValue("currentUserId").toString().equals("test")){
				paramMap.put("_result_","1=1");
			}else{
				paramMap.put("_result_","1=2");
			}
    }
</java:consequence>
</rule>

</rule-set>

